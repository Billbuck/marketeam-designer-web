<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test IntÃ©gration POC - Marketeam Designer</title>
    <!--
        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        â•‘  PAGE DE TEST - IntÃ©gration POC Sidebar & Toolbars               â•‘
        â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
        â•‘  Affiche UNE SEULE toolbar Ã  la fois selon la sÃ©lection :        â•‘
        â•‘  - text/textQuill â†’ Toolbar Texte                                â•‘
        â•‘  - image â†’ Toolbar Image                                         â•‘
        â•‘  - barcode â†’ Toolbar Code-barres                                 â•‘
        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    -->
    <style>
        :root {
            --primary-color: #1a73e8;
            --bg-color: #e0e0e0;
            --panel-bg: #ffffff;
            --border-color: #ddd;
            --success-color: #34a853;
            --error-color: #ea4335;
            --workspace-bg: #b0b0b0;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• */
        .header {
            background: var(--primary-color);
            color: white;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .header h1 { font-size: 16px; font-weight: 600; }
        
        .header .status {
            display: flex;
            gap: 12px;
            font-size: 11px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--error-color);
        }
        
        .status-dot.ready { background: var(--success-color); }
        
        /* â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â• */
        .main-layout {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        /* â•â•â•â•â•â•â• PANNEAU CONTRÃ”LE â•â•â•â•â•â•â• */
        .control-panel {
            width: 200px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border-color);
            padding: 12px;
            overflow-y: auto;
        }
        
        .control-section { margin-bottom: 15px; }
        
        .control-section h3 {
            font-size: 10px;
            text-transform: uppercase;
            color: #666;
            margin-bottom: 8px;
            padding-bottom: 4px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .btn {
            padding: 8px 10px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.15s;
        }
        
        .btn:hover {
            border-color: var(--primary-color);
            background: #f0f7ff;
        }
        
        .btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }
        
        .context-info {
            background: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 5px;
            padding: 8px;
            font-size: 11px;
            margin-top: 10px;
        }
        
        /* â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â• */
        .sidebar-wrapper {
            width: 300px;
            background: white;
            border-right: 1px solid var(--border-color);
        }
        
        .sidebar-wrapper iframe {
            border: none;
            width: 100%;
            height: 100%;
        }
        
        /* â•â•â•â•â•â•â• ZONE DE TRAVAIL â•â•â•â•â•â•â• */
        .workspace {
            flex: 1;
            background: var(--workspace-bg);
            display: flex;
            overflow: hidden;
        }
        
        /* Canvas central */
        .canvas-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .canvas {
            width: 350px;
            height: 450px;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.25);
            border-radius: 3px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #888;
            text-align: center;
            padding: 20px;
        }
        
        .canvas-icon { font-size: 48px; margin-bottom: 10px; }
        .canvas-text { font-size: 14px; }
        .canvas-hint { font-size: 11px; color: #aaa; margin-top: 5px; }
        
        /* Zone toolbar (Ã  droite du canvas) */
        .toolbar-zone {
            width: 320px;
            background: #a0a0a0;
            border-left: 1px solid #888;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .toolbar-zone-header {
            background: #666;
            color: white;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .toolbar-frame-container {
            flex: 1;
            position: relative;
        }
        
        .toolbar-frame-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }
        
        .toolbar-frame-container iframe.visible {
            display: block;
        }
        
        .toolbar-empty {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 12px;
            font-style: italic;
        }
        
        /* â•â•â•â•â•â•â• LOGS â•â•â•â•â•â•â• */
        .log-panel-header {
            background: #333;
            color: white;
            padding: 5px 12px;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-clear-logs {
            background: transparent;
            border: 1px solid #666;
            color: #ccc;
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
        }
        
        .log-panel {
            height: 100px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Consolas', monospace;
            font-size: 10px;
            overflow-y: auto;
            padding: 6px;
        }
        
        .log-entry {
            padding: 1px 0;
            display: flex;
            gap: 6px;
        }
        
        .log-time { color: #666; }
        .log-direction { width: 80px; }
        .log-direction.incoming { color: #4fc3f7; }
        .log-direction.outgoing { color: #81c784; }
        .log-content { color: #fff; }
    </style>
</head>
<body>
    <!-- â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â• -->
    <header class="header">
        <h1>ğŸ§ª Test IntÃ©gration - Marketeam Designer</h1>
        <div class="status">
            <div class="status-item">
                <span class="status-dot" id="status-sidebar"></span>
                <span>Sidebar</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="status-toolbar-text"></span>
                <span>Texte</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="status-toolbar-image"></span>
                <span>Image</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="status-toolbar-barcode"></span>
                <span>Barcode</span>
            </div>
            <div class="status-item">
                <span class="status-dot" id="status-toolbar-qrcode"></span>
                <span>QR Code</span>
            </div>
        </div>
    </header>
    
    <!-- â•â•â•â•â•â•â• LAYOUT â•â•â•â•â•â•â• -->
    <div class="main-layout">
        <!-- Panneau de contrÃ´le -->
        <aside class="control-panel">
            <div class="control-section">
                <h3>ğŸ“Œ SÃ©lection</h3>
                <div class="btn-group">
                    <button class="btn active" data-action="none">â­• Aucune</button>
                    <button class="btn" data-action="text">ğŸ“„ Texte</button>
                    <button class="btn" data-action="textQuill">âœï¸ Texte Quill</button>
                    <button class="btn" data-action="image">ğŸ–¼ï¸ Image</button>
                    <button class="btn" data-action="barcode">ğŸ“Š Code-barres</button>
                    <button class="btn" data-action="qrcode">ğŸ“± QR Code</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ‘¥ Multi</h3>
                <div class="btn-group">
                    <button class="btn" data-action="multi-2">2ï¸âƒ£ 2 zones</button>
                    <button class="btn" data-action="multi-3">3ï¸âƒ£ 3 zones</button>
                </div>
            </div>
            
            <div class="control-section">
                <h3>ğŸ› ï¸ Debug</h3>
                <div class="btn-group">
                    <button class="btn" data-action="showAll">ğŸ‘ï¸ Tout afficher</button>
                    <button class="btn" data-action="ping">ğŸ“ Ping</button>
                </div>
            </div>
            
            <div class="context-info">
                <strong>Toolbar active :</strong>
                <span id="active-toolbar">Aucune</span>
            </div>
        </aside>
        
        <!-- Sidebar -->
        <div class="sidebar-wrapper">
            <iframe id="iframe-sidebar" src="marketeam-sidebar-fixed.html"></iframe>
        </div>
        
        <!-- Zone de travail -->
        <div class="workspace">
            <!-- Canvas -->
            <div class="canvas-container">
                <div class="canvas">
                    <div class="canvas-icon" id="canvas-icon">ğŸ“„</div>
                    <div class="canvas-text" id="canvas-text">Aucune sÃ©lection</div>
                    <div class="canvas-hint">Cliquez sur un type de zone Ã  gauche</div>
                </div>
            </div>
            
            <!-- Zone Toolbar (une seule visible Ã  la fois) -->
            <div class="toolbar-zone">
                <div class="toolbar-zone-header">âš™ï¸ PropriÃ©tÃ©s</div>
                <div class="toolbar-frame-container" id="toolbar-container">
                    <iframe id="iframe-toolbar-text" src="toolbar-texte.html"></iframe>
                    <iframe id="iframe-toolbar-image" src="toolbar-image.html"></iframe>
                    <iframe id="iframe-toolbar-barcode" src="toolbar-barcode.html"></iframe>
                    <iframe id="iframe-toolbar-qrcode" src="toolbar-qrcode.html"></iframe>
                </div>
                <div class="toolbar-empty" id="toolbar-empty">
                    SÃ©lectionnez une zone pour voir ses propriÃ©tÃ©s
                </div>
            </div>
        </div>
    </div>
    
    <!-- â•â•â•â•â•â•â• LOGS â•â•â•â•â•â•â• -->
    <div class="log-panel-header">
        <span>ğŸ“‹ Console</span>
        <button class="btn-clear-logs" id="btn-clear-logs">Effacer</button>
    </div>
    <div class="log-panel" id="log-panel"></div>
    
    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // Ã‰LÃ‰MENTS DOM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const iframeSidebar = document.getElementById('iframe-sidebar');
        const iframeToolbarText = document.getElementById('iframe-toolbar-text');
        const iframeToolbarImage = document.getElementById('iframe-toolbar-image');
        const iframeToolbarBarcode = document.getElementById('iframe-toolbar-barcode');
        const iframeToolbarQRCode = document.getElementById('iframe-toolbar-qrcode');
        
        const toolbarEmpty = document.getElementById('toolbar-empty');
        const activeToolbarDisplay = document.getElementById('active-toolbar');
        const canvasIcon = document.getElementById('canvas-icon');
        const canvasText = document.getElementById('canvas-text');
        const logPanel = document.getElementById('log-panel');
        
        const statusDots = {
            sidebar: document.getElementById('status-sidebar'),
            text: document.getElementById('status-toolbar-text'),
            image: document.getElementById('status-toolbar-image'),
            barcode: document.getElementById('status-toolbar-barcode'),
            qrcode: document.getElementById('status-toolbar-qrcode')
        };
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GESTION DES TOOLBARS - UNE SEULE VISIBLE Ã€ LA FOIS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        /**
         * Affiche la toolbar correspondant au type de zone
         * @param {string|null} zoneType - Type de zone sÃ©lectionnÃ©e
         */
        function showToolbarFor(zoneType) {
            // Masquer toutes les toolbars
            iframeToolbarText.classList.remove('visible');
            iframeToolbarImage.classList.remove('visible');
            iframeToolbarBarcode.classList.remove('visible');
            iframeToolbarQRCode.classList.remove('visible');
            
            let toolbarName = 'Aucune';
            let showEmpty = true;
            
            // Afficher la toolbar appropriÃ©e
            switch (zoneType) {
                case 'text':
                case 'textQuill':
                    iframeToolbarText.classList.add('visible');
                    toolbarName = 'Texte';
                    showEmpty = false;
                    break;
                case 'image':
                    iframeToolbarImage.classList.add('visible');
                    toolbarName = 'Image';
                    showEmpty = false;
                    break;
                case 'barcode':
                    iframeToolbarBarcode.classList.add('visible');
                    toolbarName = 'Code-barres';
                    showEmpty = false;
                    break;
                case 'qrcode':
                    iframeToolbarQRCode.classList.add('visible');
                    toolbarName = 'QR Code';
                    showEmpty = false;
                    break;
            }
            
            toolbarEmpty.style.display = showEmpty ? 'flex' : 'none';
            activeToolbarDisplay.textContent = toolbarName;
        }
        
        /**
         * Met Ã  jour le canvas pour reflÃ©ter la sÃ©lection
         * @param {string} action - Action de sÃ©lection
         */
        function updateCanvas(action) {
            const icons = {
                'none': 'ğŸ“„',
                'text': 'ğŸ“',
                'textQuill': 'âœï¸',
                'image': 'ğŸ–¼ï¸',
                'barcode': 'ğŸ“Š',
                'qrcode': 'ğŸ“±',
                'multi-2': 'ğŸ“‘',
                'multi-3': 'ğŸ“š'
            };
            
            const texts = {
                'none': 'Aucune sÃ©lection',
                'text': 'Zone Texte sÃ©lectionnÃ©e',
                'textQuill': 'Zone Texte Quill sÃ©lectionnÃ©e',
                'image': 'Zone Image sÃ©lectionnÃ©e',
                'barcode': 'Zone Code-barres sÃ©lectionnÃ©e',
                'qrcode': 'Zone QR Code sÃ©lectionnÃ©e',
                'multi-2': '2 zones sÃ©lectionnÃ©es',
                'multi-3': '3 zones sÃ©lectionnÃ©es'
            };
            
            canvasIcon.textContent = icons[action] || 'ğŸ“„';
            canvasText.textContent = texts[action] || 'Aucune sÃ©lection';
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMMUNICATION POSTMESSAGE
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function addLog(direction, source, message) {
            const time = new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `
                <span class="log-time">${time}</span>
                <span class="log-direction ${direction}">${direction === 'incoming' ? 'â†' : 'â†’'} ${source}</span>
                <span class="log-content">${message.action}</span>
            `;
            logPanel.appendChild(entry);
            logPanel.scrollTop = logPanel.scrollHeight;
        }
        
        document.getElementById('btn-clear-logs').addEventListener('click', () => {
            logPanel.innerHTML = '';
        });
        
        function sendToIframes(message) {
            const msg = { ...message, timestamp: Date.now() };
            
            [iframeSidebar, iframeToolbarText, iframeToolbarImage, iframeToolbarBarcode, iframeToolbarQRCode].forEach(iframe => {
                if (iframe?.contentWindow) {
                    iframe.contentWindow.postMessage(msg, '*');
                }
            });
            addLog('outgoing', 'Designer', msg);
        }
        
        window.addEventListener('message', (event) => {
            const message = event.data;
            if (!message?.action) return;
            
            const source = message.source || 'unknown';
            addLog('incoming', source, message);
            
            if (message.action === 'ready') {
                switch (source) {
                    case 'sidebar': statusDots.sidebar.classList.add('ready'); break;
                    case 'toolbar': statusDots.text.classList.add('ready'); break;
                    case 'toolbar-image': statusDots.image.classList.add('ready'); break;
                    case 'toolbar-barcode': statusDots.barcode.classList.add('ready'); break;
                    case 'toolbar-qrcode': statusDots.qrcode.classList.add('ready'); break;
                }
            }
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONTEXTES DE SÃ‰LECTION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function generateContext(action) {
            const contexts = {
                'none': { zoneType: null, selectionCount: 0, selectedZoneIds: [] },
                'text': { zoneType: 'text', selectionCount: 1, selectedZoneIds: ['zone-1'] },
                'textQuill': { zoneType: 'textQuill', selectionCount: 1, selectedZoneIds: ['zone-2'] },
                'image': { zoneType: 'image', selectionCount: 1, selectedZoneIds: ['zone-3'] },
                'barcode': { zoneType: 'barcode', selectionCount: 1, selectedZoneIds: ['zone-4'] },
                'qrcode': { zoneType: 'qrcode', selectionCount: 1, selectedZoneIds: ['zone-5'] },
                'multi-2': { zoneType: null, selectionCount: 2, selectedZoneIds: ['zone-1', 'zone-2'] },
                'multi-3': { zoneType: null, selectionCount: 3, selectedZoneIds: ['zone-1', 'zone-2', 'zone-3'] }
            };
            return contexts[action] || contexts['none'];
        }
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // BOUTONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        document.querySelectorAll('.btn[data-action]').forEach(btn => {
            btn.addEventListener('click', () => {
                const action = btn.dataset.action;
                
                // Mettre Ã  jour les boutons
                document.querySelectorAll('.btn[data-action]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Debug
                if (action === 'showAll') {
                    sendToIframes({ action: 'showAllSections' });
                    // Afficher toutes les toolbars en mode debug
                    iframeToolbarText.classList.add('visible');
                    iframeToolbarImage.classList.add('visible');
                    iframeToolbarBarcode.classList.add('visible');
                    iframeToolbarQRCode.classList.add('visible');
                    toolbarEmpty.style.display = 'none';
                    activeToolbarDisplay.textContent = 'Toutes (debug)';
                    return;
                }
                if (action === 'ping') {
                    sendToIframes({ action: 'ping' });
                    return;
                }
                
                // SÃ©lection normale
                const context = generateContext(action);
                updateCanvas(action);
                showToolbarFor(context.zoneType);
                sendToIframes({ action: 'selectionChanged', data: context });
            });
        });
        
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INIT
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        // Ã‰tat initial : aucune toolbar
        showToolbarFor(null);
        
        addLog('outgoing', 'Designer', { action: 'init' });
        console.log('ğŸ§ª Page de test initialisÃ©e');
    </script>
</body>
</html>
